import{m as k,_ as m,r as h,o as r,c,a as o,b as _,w as C,d as g,t as l,F as B,e as b,p as y,f as z,g as p,h as S}from"./index-1eimlCe9.js";const L={name:"BookListItem",props:{item:{type:Object,default:()=>{}}},inject:["factPrice","currency"],methods:{...k("cart",{addCart:"addProductToCart"}),addCartItem(e){let t=1,s={...e,price:this.factPrice(e.price,e.discount),quantity:t};this.addCart(s),this.$router.push("/cart")}}},x={class:"bookListItem"},I=["src"],v={class:"title"},N={class:"factPrice"},P={class:"price"};function R(e,t,s,a,n,i){const u=h("router-link");return r(),c("div",x,[o("div",null,[o("img",{src:s.item.image},null,8,I)]),o("p",v,[_(u,{to:{name:"book",params:{id:s.item.id}},target:"_blank"},{default:C(()=>[g(l(s.item.title),1)]),_:1},8,["to"])]),o("p",null,[o("span",N,l(i.currency(i.factPrice(s.item.price,s.item.discount))),1),o("span",null,[g(" 定价："),o("i",P,l(i.currency(s.item.price)),1)])]),o("p",null,[o("span",null,l(s.item.author),1),g(" / "),o("span",null,l(s.item.publishDate),1),g(" / "),o("span",null,l(s.item.bookConcern),1)]),o("p",null,l(s.item.brief),1),o("p",null,[o("button",{class:"addCartButton",onClick:t[0]||(t[0]=d=>i.addCartItem(s.item))}," 加入购物车 ")])])}const q=m(L,[["render",R],["__scopeId","data-v-3e8dc3bf"]]),U={name:"BookList",props:{list:{type:Array,default:()=>[]}},components:{BookListItem:q}};function w(e,t,s,a,n,i){const u=h("BookListItem");return r(),c("div",null,[(r(!0),c(B,null,b(s.list,d=>(r(),c("div",{key:d.id},[_(u,{item:d},null,8,["item"])]))),128))])}const $=m(U,[["render",w]]),O={name:"Loading"},V=e=>(y("data-v-d75cc27e"),e=e(),z(),e),j={class:"loading"},A=V(()=>o("div",{class:"shadow"},[o("div",{class:"loader"},[o("div",{class:"mask"})])],-1)),D=[A];function E(e,t,s,a,n,i){return r(),c("div",j,D)}const F=m(O,[["render",E],["__scopeId","data-v-d75cc27e"]]),T={name:"Books",data(){return{title:"",books:[],message:"",loading:!0,total:5,pageNum:1,pageSize:2}},beforeRouteEnter(e,t,s){s(a=>{a.title=e.meta.title;let n=a.setRequestUrl(e.fullPath);a.getBooks(n,a.pageNum,a.pageSize)})},beforeRouteUpdate(e){let t=this.setRequestUrl(e.fullPath);return this.getBooks(t,this.pageNum,this.pageSize),!0},components:{BookList:$,Loading:F},methods:{getBooks(e,t,s){this.message="",this.axios.get(e,{params:{pageNum:t,pageSize:s}}).then(a=>{a.status==200&&(this.loading=!1,this.books=a.data.data,this.total=a.data.total,this.books.length===0&&(this.$route.name==="category"?this.message="当前分类下没有图书！":this.message="没有搜索到匹配的图书！"))}).catch(a=>alert(a))},setRequestUrl(e){let t=e;if(e.indexOf("/category")!=-1)t="/book"+t+"/page";else if(e.indexOf("/search")!=-1){let a=e.indexOf("/search")+7;t=t.slice(0,a)+"/page"+t.slice(a,t.length)}return t},handleSizeChange(e){this.pageSize=e;let t=this.setRequestUrl(this.$route.fullPath);this.getBooks(t,this.pageNum,this.pageSize)},handleCurrentChange(e){this.pageNum=e;let t=this.setRequestUrl(this.$route.fullPath);this.getBooks(t,this.pageNum,this.pageSize)}}},G={key:1};function H(e,t,s,a,n,i){const u=h("Loading"),d=h("BookList"),f=h("el-pagination");return r(),c("div",null,[n.loading?(r(),p(u,{key:0})):(r(),c("h3",G,l(n.title),1)),n.books.length?(r(),p(d,{key:2,list:n.books},null,8,["list"])):S("",!0),o("h1",null,l(n.message),1),_(f,{"hide-on-single-page":!1,onSizeChange:i.handleSizeChange,"page-sizes":[2,10,20,40],onCurrentChange:i.handleCurrentChange,"current-page":n.pageNum,"page-size":n.pageSize,layout:"total,sizes,prev,pager,next,jumper",total:n.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])}const K=m(T,[["render",H]]);export{K as default};
